# Waveshare 1.47inch LCD Module

The files here are copied from the [Waveshare Wiki](https://www.waveshare.com/wiki/1.47inch_LCD_Module) for the 1.47 inch LCD Module which is based off the ST7789V3 chipset.

The driver has been modified as follows:

* I2C and Infrared has been removed since the LCD used in this project only uses SPI.
* The pin configuration in `Dev_Config.h` has been replaced by config passed to `lcd_init_hardware()` to enable multiple displays from the single driver.
* Fixed width fonts and the associated functions have been removed and onlt those generated by `fontgen` are supported.

## Pico pinout

| Pin to device mapping   | Name      | Pin | Pico  | Pin | Name      | Pin to device mapping   |
|-------------------------|-----------|-----| ----- |-----|-----------|-------------------------|
| Debug Probe RX          | GP0       | 1   | XXXXX | 40  | VBUS 5V   |                         |
| Debug Probe TX          | GP1       | 2   | XXXXX | 39  | VSYS 5V   |                         |
| Debug Probe GND         | GND       | 3   | XXXXX | 38  | GND       | LCD GND                 |
| LCD 3 data/command (DC) | GP2       | 4   | XXXXX | 37  | 3V3 En    |                         |
| LCD 3 chip select (CS)  | GP3       | 5   | XXXXX | 36  | 3V3 Out   | LCD VCC                 |
| LCD 4 data/command (DC) | GP4       | 6   | XXXXX | 35  | ADC VRef  |                         |
| LCD 4 chip select (CS)  | GP5       | 7   | XXXXX | 34  | GP28 A2   |                         |
|                         | GND       | 8   | XXXXX | 33  | ADC Gnd   |                         |
| LCD 1 data/command (DC) | GP6       | 9   | XXXXX | 32  | GP27 A1   |                         |
| LCD 1 chip select (CS)  | GP7       | 10  | XXXXX | 31  | GP26 A0   |                         |
| LCD 2 data/command (DC) | GP8       | 11  | XXXXX | 30  | RUN       |                         |
| LCD 2 chip select (CS)  | GP9       | 12  | XXXXX | 29  | GP22      |                         |
|                         | GND       | 13  | XXXXX | 28  | GND       |                         |
| Shared clock (CLK)      | GP10      | 14  | XXXXX | 27  | GP21      |                         |
| Shared MOSI (DIN)       | GP11      | 15  | XXXXX | 26  | GP20      |                         |
| Shared reset (RST)      | GP12      | 16  | XXXXX | 25  | GP19      | LCD 7 chip select (CS)  |
| Shared backlight (BL)   | GP13      | 17  | XXXXX | 24  | GP18      | LCD 7 data/command (DC) |
|                         | GND       | 18  | XXXXX | 23  | GND       |                         |
| LCD 5 data/command (DC) | GP14      | 19  | XXXXX | 22  | GP17      | LCD 6 chip select (CS)  |
| LCD 5 chip select (CS)  | GP15      | 20  | XXXXX | 21  | GP16      | LCD 6 data/command (DC) |

## LCD connections

The default GPIO configuration is assumed, as defined in `lib/Config/DEV_Config.h`:

| Pico    | LCD 1 | LCD 2 | LCD 3 | LCD 4 | LCD 5 | LCD 6 | LCD 7 |
|---------|-------|-------|-------+-------+-------+-------+-------+
| 3V3 Out | VCC   | VCC   | VCC   | VCC   | VCC   | VCC   | VCC   |
| GND     | GND   | GND   | GND   | GND   | GND   | GND   | GND   |
| GP11    | DIN   | DIN   | DIN   | DIN   | DIN   | DIN   | DIN   |
| GP10    | CLK   | CLK   | CLK   | CLK   | CLK   | CLK   | CLK   |
| GP2     |       |       | DC    |       |       |       |       |
| GP3     |       |       | CS    |       |       |       |       |
| GP4     |       |       |       | DC    |       |       |       |
| GP5     |       |       |       | CS    |       |       |       |
| GP6     | DC    |       |       |       |       |       |       |
| GP7     | CS    |       |       |       |       |       |       |
| GP8     |       | DC    |       |       |       |       |       |
| GP9     |       | CS    |       |       |       |       |       |
| GP12    | RST   | RST   | RST   | RST   | RST   | RST   | RST   |
| GP13    | BL    | BL    | BL    | BL    | BL    | BL    | BL    |
| GP14    |       |       |       |       | DC    |       |       |
| GP15    |       |       |       |       | CS    |       |       |
| GP16    |       |       |       |       |       | DC    |       |
| GP17    |       |       |       |       |       | CS    |       |
| GP18    |       |       |       |       |       |       | DC    |
| GP19    |       |       |       |       |       |       | CS    |

## TODO List

1. Only update the display time when the clock digits change
2. Look at whether the scan across the display can be eliminated
3. Move the LCD code away from a frame-buffer to direct SPI calls
4. Complete HAL for all calls
    * NTP still needs to be done
    * Only log LCD updates that are meaningful
